{"version":3,"sources":["js/scripts.js"],"names":["postCache","currentEditID","submit","e","preventDefault","username","document","querySelector","title","message","isSpoiler","isBug","isFluff","json","value","checked","body","JSON","stringify","fetch","method","headers","Headers","then","response","status","text","template","data","parse","getElementById","innerHTML","posts","html","console","log","reloadPosts","catch","statusText","logout","url","request","XMLHttpRequest","open","onload","window","location","replace","responseURL","onerror","send","event","loadEditFields","id","parseInt","map","entry","_id","includes","msg","cats","button","toUnhide","forEach","element","style","display","post","filter","submitEdit","del","deleteID","onclick"],"mappings":"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","file":"scripts.4b004cfd.js","sourceRoot":"","sourcesContent":["let postCache = [];\r\nlet currentEditID = -1;\r\n\r\nconst submit = function (e) {\r\n  // prevent default form action from being carried out\r\n  e.preventDefault();\r\n\r\n  const username = document.querySelector(\"#username\");\r\n  const title = document.querySelector(\"#title\");\r\n  const message = document.querySelector(\"#message\");\r\n  const isSpoiler = document.querySelector(\"#spoiler\");\r\n  const isBug = document.querySelector(\"#bug\");\r\n  const isFluff = document.querySelector(\"#fluff\");\r\n\r\n  const json = {\r\n    username: username.value,\r\n    title: title.value,\r\n    message: message.value,\r\n    isSpoiler: isSpoiler.checked,\r\n    isBug: isBug.checked,\r\n    isFluff: isFluff.checked,\r\n  };\r\n  title.value = \"\";\r\n  message.value = \"\";\r\n  isSpoiler.checked = false;\r\n  isBug.checked = false;\r\n  isFluff.checked = false;\r\n\r\n  const body = JSON.stringify(json);\r\n\r\n  fetch(\"/submit\", {\r\n    method: \"POST\",\r\n    headers: new Headers({ \"Content-Type\": \"application/json\" }),\r\n    body,\r\n  })\r\n    .then(function (response) {\r\n      switch (response.status) {\r\n        case 200:\r\n          return response.text();\r\n        case 404:\r\n          throw response;\r\n      }\r\n    })\r\n    .then(function (template) {\r\n      data = JSON.parse(template);\r\n      document.getElementById(\"posts\").innerHTML = data.posts.html;\r\n      console.log(document.getElementById(\"posts\"));\r\n      postCache = data.posts.json;\r\n      reloadPosts();\r\n    })\r\n    .catch(function (response) {\r\n      console.log(response.statusText);\r\n    });\r\n\r\n  return false;\r\n};\r\n\r\nfunction logout() {\r\n  var url = \"/logout\";\r\n  var request = new XMLHttpRequest();\r\n  request.open(\"POST\", url, true);\r\n  request.onload = function () {\r\n    window.location.replace(request.responseURL);\r\n  };\r\n  request.onerror = function () {};\r\n  request.send();\r\n  event.preventDefault();\r\n  return false;\r\n}\r\n\r\nwindow.onload = function () {\r\n  const submitButton = document.getElementById(\"create-post\");\r\n  submitButton.onclick = submit;\r\n  const loadButton = document.getElementById(\"load-post\");\r\n  loadButton.onclick = loadEditFields;\r\n  const deletePost = document.getElementById(\"delete-post\");\r\n  deletePost.onclick = del;\r\n  const editPost = document.getElementById(\"edit-post\");\r\n  editPost.onclick = submitEdit;\r\n  const logoutForum = document.getElementById(\"logout\");\r\n  logoutForum.onclick = logout;\r\n};\r\n\r\nfunction reloadPosts() {\r\n  fetch(\"/posts\")\r\n    .then(function (response) {\r\n      switch (response.status) {\r\n        case 200:\r\n          return response.text();\r\n        case 404:\r\n          throw response;\r\n      }\r\n    })\r\n    .then(function (template) {\r\n      data = JSON.parse(template);\r\n      document.getElementById(\"posts\").innerHTML = data.posts.html;\r\n      postCache = data.posts.json;\r\n    })\r\n    .catch(function (response) {\r\n      console.log(response.statusText);\r\n    });\r\n\r\n  fetch(\"/userposts\")\r\n    .then(function (response) {\r\n      switch (response.status) {\r\n        case 200:\r\n          return response.text();\r\n        case 404:\r\n          throw response;\r\n      }\r\n    })\r\n    .then(function (template) {\r\n      data = JSON.parse(template);\r\n      document.getElementById(\"userposts\").innerHTML = data.posts.html;\r\n    })\r\n    .catch(function (response) {\r\n      console.log(response.statusText);\r\n    });\r\n}\r\n\r\nfunction loadEditFields() {\r\n  const id = parseInt(document.getElementById(\"edit-id\").value, 10);\r\n  if (\r\n    !postCache\r\n      .map((entry) => {\r\n        return entry._id;\r\n      })\r\n      .includes(id)\r\n  ) {\r\n    return false;\r\n  }\r\n  currentEditID = id;\r\n\r\n  // unhide\r\n  const title = document.getElementById(\"hide-title\"),\r\n    msg = document.getElementById(\"hide-message\"),\r\n    cats = document.getElementById(\"hide-categories\"),\r\n    button = document.getElementById(\"hide-button\");\r\n\r\n  toUnhide = [title, msg, cats, button];\r\n  toUnhide.forEach((element) => {\r\n    element.style.display = \"block\";\r\n  });\r\n\r\n  // fill in form\r\n  post = postCache.filter((post) => post._id == id)[0];\r\n  document.getElementById(\"edit-title\").value = post.title;\r\n  document.getElementById(\"edit-message\").value = post.message;\r\n  document.getElementById(\"edit-spoiler\").checked = post.isSpoiler;\r\n  document.getElementById(\"edit-bug\").checked = post.isBug;\r\n  document.getElementById(\"edit-fluff\").checked = post.isFluff;\r\n\r\n  return false;\r\n}\r\nfunction submitEdit() {\r\n  // hide\r\n  const titleElm = document.getElementById(\"hide-title\"),\r\n    msgElm = document.getElementById(\"hide-message\"),\r\n    catsElm = document.getElementById(\"hide-categories\"),\r\n    buttonElm = document.getElementById(\"hide-button\"),\r\n    toUnhide = [titleElm, msgElm, catsElm, buttonElm];\r\n  toUnhide.forEach((element) => {\r\n    element.style.display = \"none\";\r\n  });\r\n  document.getElementById(\"edit-id\").value = \"\";\r\n\r\n  const title = document.querySelector(\"#edit-title\");\r\n  const message = document.querySelector(\"#edit-message\");\r\n  const isSpoiler = document.querySelector(\"#edit-spoiler\");\r\n  const isBug = document.querySelector(\"#edit-bug\");\r\n  const isFluff = document.querySelector(\"#edit-fluff\");\r\n\r\n  const json = {\r\n    id: currentEditID,\r\n    title: title.value,\r\n    message: message.value,\r\n    isSpoiler: isSpoiler.checked,\r\n    isBug: isBug.checked,\r\n    isFluff: isFluff.checked,\r\n  };\r\n  const body = JSON.stringify(json);\r\n\r\n  fetch(\"/edit\", {\r\n    method: \"POST\",\r\n    headers: new Headers({ \"Content-Type\": \"application/json\" }),\r\n    body,\r\n  })\r\n    .then(function (response) {\r\n      console.log(response);\r\n      switch (response.status) {\r\n        case 200:\r\n          return response.text();\r\n        case 404:\r\n          throw response;\r\n      }\r\n    })\r\n    .then(function (template) {\r\n      console.log(template);\r\n      data = JSON.parse(template);\r\n      document.getElementById(\"posts\").innerHTML = data.posts.html;\r\n      postCache = data.posts.json;\r\n      reloadPosts();\r\n    })\r\n    .catch(function (response) {\r\n      console.log(response.statusText);\r\n    });\r\n\r\n  return false;\r\n}\r\n\r\nfunction del() {\r\n  const deleteID = document.querySelector(\"#delete-id\");\r\n\r\n  const json = {\r\n    id: parseInt(deleteID.value, 10),\r\n  };\r\n  deleteID.value = \"\";\r\n  const body = JSON.stringify(json);\r\n\r\n  fetch(\"/delete\", {\r\n    method: \"POST\",\r\n    headers: new Headers({ \"Content-Type\": \"application/json\" }),\r\n    body,\r\n  })\r\n    .then(function (response) {\r\n      console.log(response);\r\n      switch (response.status) {\r\n        case 200:\r\n          return response.text();\r\n        case 404:\r\n          throw response;\r\n      }\r\n    })\r\n    .then(function (template) {\r\n      data = JSON.parse(template);\r\n      document.getElementById(\"posts\").innerHTML = data.posts.html;\r\n      postCache = data.posts.json;\r\n      reloadPosts();\r\n    })\r\n    .catch(function (response) {\r\n      console.log(response.statusText);\r\n    });\r\n\r\n  return false;\r\n}\r\n\r\nreloadPosts();\r\n"]}